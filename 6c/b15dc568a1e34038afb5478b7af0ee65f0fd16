v2: new patch, with the refactor moved out from the following one
