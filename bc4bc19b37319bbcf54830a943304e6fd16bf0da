v3: new patch, passes all tests on it's own
